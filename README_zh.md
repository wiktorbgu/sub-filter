[EN](README_en.md) / [RU](README.md)  / [ZH](README_zh.md) 

æ­¤ç¿»è¯‘ç”±ç¥ç»ç½‘ç»œå®Œæˆï¼Œå¦‚æœ‰ä»»ä½•é”™è¯¯ï¼Œæ•¬è¯·è°…è§£ã€‚

- [sub-filter](#sub-filter)
  - [ç¨‹å¼åŠŸèƒ½](#ç¨‹å¼åŠŸèƒ½)
  - [å¦‚ä½•ç·¨è­¯ç¨‹å¼ï¼Ÿ](#å¦‚ä½•ç·¨è­¯ç¨‹å¼)
  - [å¦‚ä½•åŸ·è¡Œï¼Ÿ](#å¦‚ä½•åŸ·è¡Œ)
    - [æ¨¡å¼ 1ï¼šHTTP ä¼ºæœå™¨ï¼ˆå‹•æ…‹éæ¿¾ï¼‰](#æ¨¡å¼-1http-ä¼ºæœå™¨å‹•æ…‹éæ¿¾)
      - [å®Œæ•´è¨­å®šç¯„ä¾‹](#å®Œæ•´è¨­å®šç¯„ä¾‹)
      - [æœ€å°è¨­å®šç¯„ä¾‹](#æœ€å°è¨­å®šç¯„ä¾‹)
    - [æ¨¡å¼ 2ï¼šCLIï¼ˆä¸€æ¬¡æ€§è™•ç†ï¼‰](#æ¨¡å¼-2cliä¸€æ¬¡æ€§è™•ç†)
      - [å®Œæ•´è¨­å®šç¯„ä¾‹](#å®Œæ•´è¨­å®šç¯„ä¾‹-1)
      - [æœ€å°è¨­å®šç¯„ä¾‹](#æœ€å°è¨­å®šç¯„ä¾‹-1)
  - [åƒæ•¸èªªæ˜](#åƒæ•¸èªªæ˜)
  - [å¦‚ä½•é©—è­‰æ˜¯å¦æ­£å¸¸é‹ä½œï¼Ÿ](#å¦‚ä½•é©—è­‰æ˜¯å¦æ­£å¸¸é‹ä½œ)
    - [ä¼ºæœå™¨æ¨¡å¼](#ä¼ºæœå™¨æ¨¡å¼)
    - [CLI æ¨¡å¼](#cli-æ¨¡å¼)
  - [å¦‚ä½•åœ¨å®¢æˆ¶ç«¯ä¸­ä½¿ç”¨ï¼Ÿ](#å¦‚ä½•åœ¨å®¢æˆ¶ç«¯ä¸­ä½¿ç”¨)
  - [å¦‚ä½•å»ºç«‹ Docker æ˜ åƒï¼Ÿ](#å¦‚ä½•å»ºç«‹-docker-æ˜ åƒ)
  - [å¦‚ä½•åœ¨ Docker ä¸­åŸ·è¡Œï¼Ÿ](#å¦‚ä½•åœ¨-docker-ä¸­åŸ·è¡Œ)
    - [ä½¿ç”¨ Docker](#ä½¿ç”¨-docker)
    - [ä½¿ç”¨ Podmanï¼ˆDocker æ›¿ä»£æ–¹æ¡ˆï¼‰](#ä½¿ç”¨-podmandocker-æ›¿ä»£æ–¹æ¡ˆ)
  - [Docker ä¸­çš„ CLI æ¨¡å¼](#docker-ä¸­çš„-cli-æ¨¡å¼)

# sub-filter

ç°¡å–®çš„è¨‚é–±éæ¿¾å™¨

æœ¬ç¨‹å¼æ˜¯ä¸€å€‹æ™ºæ…§å‹ä»£ç†ä¼ºæœå™¨é€£çµï¼ˆVLESSã€VMessã€Trojanã€Shadowsocksï¼‰éæ¿¾å™¨ã€‚å®ƒæœƒå–å¾—å…¬é–‹è¨‚é–±ï¼Œæª¢æŸ¥æ¯å€‹ä¼ºæœå™¨çš„æ­£ç¢ºæ€§èˆ‡å®‰å…¨æ€§ï¼ˆä¾‹å¦‚ï¼šå°é–æœªåŠ å¯†çš„é€£ç·šæˆ–åŒ…å«é•ç¦è©çš„åç¨±ï¼‰ï¼Œç§»é™¤æ‰€æœ‰å¯ç–‘å…§å®¹ï¼Œä¸¦è¼¸å‡ºä¹¾æ·¨ã€å¯ç”¨çš„æ¸…å–®â€”â€”å¯ç›´æ¥ç”¨æ–¼ Clashã€Sing-Boxã€è·¯ç”±å™¨åŠå…¶ä»–å®¢æˆ¶ç«¯ã€‚

å¦‚æœæ‚¨å°æœ¬ç¨‹å¼çš„ç”¨é€”æœ‰ç–‘å•ï¼Œè«‹é–±è®€ [FAQ](FAQ_zh.md)ã€‚

âš ï¸ è¯¥ç¨‹åºä¸ä¼šæ£€æŸ¥ä»£ç†çš„å­˜æ´»èƒ½åŠ›ã€‚å¦‚éœ€æ­¤åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ https://github.com/kutovoys/xray-checker

---

## ç¨‹å¼åŠŸèƒ½

âœ… é©—è­‰é€£çµä¸¦ç§»é™¤ä¸å®‰å…¨æˆ–æå£çš„è¨­å®š  
âœ… æ ¹æ“šé•ç¦è©æ¸…å–®éæ¿¾ä¼ºæœå™¨ï¼ˆä¾‹å¦‚ï¼šå¯ç–‘ç¶²åŸŸï¼‰  
âœ… å°é–å…¬é–‹è¨‚é–±ä¸­å¸¸è¦‹çš„ã€Œèœœç½ã€ï¼ˆhoneypotsï¼‰  
âœ… å¿«å–çµæœï¼ˆé è¨­ 30 åˆ†é˜ï¼‰ï¼Œé¿å…éåº¦æ¶ˆè€—ç¶²è·¯èˆ‡ä¼ºæœå™¨è³‡æº  
âœ… ç”Ÿæˆæ ¼å¼æ­£ç¢ºã€æè¿°æ¸…æ™°çš„è¨‚é–±

---

## å¦‚ä½•ç·¨è­¯ç¨‹å¼ï¼Ÿ

è‹¥æ‚¨å·²å®‰è£ Goï¼ˆç‰ˆæœ¬ 1.21 æˆ–æ›´æ–°ï¼‰ï¼Œè«‹åœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œï¼š

```
go build -o filter .
```

åŸ·è¡Œå¾Œæœƒç”¢ç”Ÿ `filter` æª”æ¡ˆâ€”â€”é€™å°±æ˜¯æ‚¨çš„ç¨‹å¼ã€‚

> ğŸ’¡ è‹¥æ‚¨æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨çµ‚ç«¯æ©Ÿâ€”â€”ç›´æ¥è¤‡è£½æŒ‡ä»¤å³å¯ï¼Œå®ƒæœƒæ­£å¸¸é‹ä½œï¼

---

## å¦‚ä½•åŸ·è¡Œï¼Ÿ

æœ¬ç¨‹å¼æ”¯æ´å…©ç¨®æ¨¡å¼ï¼š**HTTP ä¼ºæœå™¨** èˆ‡ **CLIï¼ˆå‘½ä»¤åˆ—ï¼‰**ã€‚

### æ¨¡å¼ 1ï¼šHTTP ä¼ºæœå™¨ï¼ˆå‹•æ…‹éæ¿¾ï¼‰

éœ€æŒ‡å®šé€£æ¥åŸ ã€‚æ¯æ¬¡è«‹æ±‚æ™‚å³æ™‚éæ¿¾è¨‚é–±ã€‚

#### å®Œæ•´è¨­å®šç¯„ä¾‹

```
./filter 8000 1800 ./config/sub.txt ./config/bad.txt ./config/uagent.txt
```

#### æœ€å°è¨­å®šç¯„ä¾‹

```
./filter 8000 1800
```

ï¼ˆæ­¤æƒ…æ³ä¸‹ï¼Œç¨‹å¼æœƒå¾ `./config/` ç›®éŒ„è®€å–æª”æ¡ˆï¼‰

### æ¨¡å¼ 2ï¼šCLIï¼ˆä¸€æ¬¡æ€§è™•ç†ï¼‰

ä¸€æ¬¡æ€§è™•ç†æ‰€æœ‰è¨‚é–±ï¼Œä¸¦å°‡çµæœå„²å­˜è‡³ `./cache` è³‡æ–™å¤¾ã€‚é©ç”¨æ–¼è‡ªå‹•åŒ–ã€å®šæ™‚ä»»å‹™ï¼ˆå¦‚ cronï¼‰æˆ–é›¢ç·šä½¿ç”¨ã€‚

#### å®Œæ•´è¨­å®šç¯„ä¾‹

```
./filter --cli 1800 ./config/sub.txt ./config/bad.txt ./config/uagent.txt
```

#### æœ€å°è¨­å®šç¯„ä¾‹

```
./filter --cli
```

ï¼ˆä½¿ç”¨ `./config/` ä¸­çš„é è¨­æª”æ¡ˆï¼ŒTTL=1800 ç§’ï¼‰

> ğŸ’¡ çµæœæœƒå„²å­˜ç‚º `./cache/mod_1.txt`ã€`./cache/mod_2.txt` ç­‰ã€‚  
> è¢«æ‹’çš„é …ç›®æœƒå„²å­˜æ–¼ `./cache/rejected_1.txt` ç­‰ã€‚

---

## åƒæ•¸èªªæ˜

| åƒæ•¸         | èªªæ˜                                                     |
| ------------ | -------------------------------------------------------- |
| `8000`       | ä¼ºæœå™¨é‹è¡ŒåŸ ï¼ˆåƒ…ä¼ºæœå™¨æ¨¡å¼ï¼‰                             |
| `1800`       | å¿«å–ä¿ç•™æ™‚é–“ï¼ˆç§’ï¼‰ï¼ˆ1800 = 30 åˆ†é˜ï¼‰                     |
| `sub.txt`    | è¨‚é–±ç¶²å€ï¼ˆæ¯è¡Œä¸€å€‹ï¼‰                                     |
| `bad.txt`    | ç¦æ­¢å‡ºç¾åœ¨è¨‚é–±ä¸­çš„è©å½™ï¼ˆä¾‹å¦‚ï¼šå¯ç–‘ç¶²åŸŸï¼‰                 |
| `uagent.txt` | å…è¨±çš„å®¢æˆ¶ç«¯ï¼ˆUser-Agentï¼‰ï¼Œä¾‹å¦‚ `Clash`ã€`Shadowrocket` |

> ğŸ’¡ è‹¥æœªæŒ‡å®šæª”æ¡ˆè·¯å¾‘ï¼Œç¨‹å¼æœƒåœ¨ `./config/` ä¸­å°‹æ‰¾ã€‚

---

## å¦‚ä½•é©—è­‰æ˜¯å¦æ­£å¸¸é‹ä½œï¼Ÿ

### ä¼ºæœå™¨æ¨¡å¼

å˜—è©¦è«‹æ±‚ `sub.txt` ç¬¬ä¸€è¡Œçš„éæ¿¾å¾Œè¨‚é–±ï¼š

```
curl -H "User-Agent: Clash" "http://localhost:8000/filter?id=1"
```

è‹¥è¨­å®šæ­£ç¢ºï¼Œæ‚¨å°‡çœ‹åˆ°ä¹¾æ·¨çš„è¨‚é–±å…§å®¹ã€‚

> ğŸ’¡ æç¤ºï¼šè«‹ç¢ºä¿ `uagent.txt` ä¸­åŒ…å«æ‚¨çš„å®¢æˆ¶ç«¯åç¨±ï¼ˆä¾‹å¦‚ `Clash`ï¼‰ï¼Œä»¥ç¢ºä¿è¨‚é–±èƒ½æ­£ç¢ºè¼‰å…¥ã€‚

### CLI æ¨¡å¼

åŸ·è¡Œ `--cli` å¾Œï¼Œæª¢æŸ¥ `./cache` è³‡æ–™å¤¾ï¼š

```
ls -l ./cache/
cat ./cache/mod_1.txt
```

æ‚¨å°‡çœ‹åˆ°å¯ç›´æ¥ä½¿ç”¨çš„è¨‚é–±ï¼Œç„¡éœ€å•Ÿå‹•ä¼ºæœå™¨ã€‚

---

## å¦‚ä½•åœ¨å®¢æˆ¶ç«¯ä¸­ä½¿ç”¨ï¼Ÿ

åœ¨å®¢æˆ¶ç«¯ä¸­æ–°å¢å¦‚ä¸‹æ ¼å¼çš„è¨‚é–±ï¼š

```
http://server:port/filter?id=number
```

è«‹æ›¿æ›ï¼š
- `server` â†’ æ‚¨çš„è·¯ç”±å™¨ã€Raspberry Pi æˆ–ä¼ºæœå™¨ IP  
- `port` â†’ å•Ÿå‹•æ™‚æŒ‡å®šçš„é€£æ¥åŸ ï¼ˆä¾‹å¦‚ `8000`ï¼‰  
- `number` â†’ `sub.txt` ä¸­è¨‚é–±çš„è¡Œè™Ÿï¼ˆç¬¬ä¸€è¡Œç‚º `id=1`ï¼‰

> ğŸ”’ å»ºè­°å°‡æœ¬ç¨‹å¼ç½®æ–¼æ”¯æ´ HTTPS çš„åå‘ä»£ç†å¾Œæ–¹ï¼ˆå¦‚ Nginxã€Caddy æˆ– Cloudflareï¼‰ï¼Œç‰¹åˆ¥æ˜¯ç•¶æœå‹™å¯å¾ç¶²éš›ç¶²è·¯å­˜å–æ™‚ã€‚

---

## å¦‚ä½•å»ºç«‹ Docker æ˜ åƒï¼Ÿ

```
docker build -t sub-filter .
```

---

## å¦‚ä½•åœ¨ Docker ä¸­åŸ·è¡Œï¼Ÿ

### ä½¿ç”¨ Docker

```
docker run -d \
  --name sub-filter \
  -p 8000:8000 \
  -v $(pwd)/config:/config:ro \
  -v $(pwd)/cache:/cache:rw \
  sub-filter \
  8000 1800
```

### ä½¿ç”¨ Podmanï¼ˆDocker æ›¿ä»£æ–¹æ¡ˆï¼‰

```
podman run -d --replace \
  --name sub-filter \
  -p 8000:8000 \
  -v $(pwd)/config:/config:ro,z \
  -v $(pwd)/cache:/cache:rw,z \
  sub-filter \
  8000 1800
```

> ğŸ“ åŸ·è¡Œå‰è«‹ç¢ºä¿ `./config` èˆ‡ `./cache` ç›®éŒ„å­˜åœ¨ï¼š
> ```
> mkdir -p ./config ./cache
> ```

---

## Docker ä¸­çš„ CLI æ¨¡å¼

æ‚¨å¯åœ¨ Docker ä¸­åŸ·è¡Œä¸€æ¬¡æ€§è™•ç†ï¼š

```
docker run --rm \
  -v $(pwd)/config:/config:ro \
  -v $(pwd)/cache:/cache:rw \
  sub-filter \
  --cli 1800
```

çµæœæœƒå„²å­˜è‡³æ‚¨æœ¬æ©Ÿçš„ `./cache` è³‡æ–™å¤¾ã€‚

