- [sub-filter](#sub-filter)
    - [Функции](#функции)
    - [Сборка](#сборка)
    - [Запуск](#запуск)
    - [Параметры:](#параметры)
    - [Проверка работы и использования](#проверка-работы-и-использования)
    - [Сборка образа](#сборка-образа)
      - [Запуск с аргументами](#запуск-с-аргументами)


# sub-filter

simple subscription filter


Скрипт для фильтрации на лету подписок, для софта, который не поддерживает некоторые функции.

### Функции

* проверяет валидность ссылок, убирает из них некоторые особенности, которые они не поддерживают
* позволяет фильтровать подписки по перечню плохих слов bad.txt
* удаляет возможные ханипоты из подписок, что важно если вы берете их из пабликов
* простое кеширование для снижения нагрузки на сетевые функции
* описание подписки приводится в человекочитаемый вид

### Сборка

 ```
 go build -o filter main.go 
 ```

### Запуск

Пример с полными аргументами

 ```
 ./filter 8000 1800 ./config/sub.txt ./config/bad.txt ./config/uagent.txt
 ```

Пример с важными аргументами
 ```
 ./filter 8000 1800
 ```

### Параметры:

* порт, который слушать (8000)
* время кеширования подписки (1800)
* файл с подписками (sub.txt)
* запрещенные слова для подписок (bad.txt)
* юзерагенты, которые можно отдавать результат (uagent.txt)

### Проверка работы и использования

Получения отфильтрованной подписки из списка sub.txt с номером строки 1

```
curl -H "User-Agent: Clash" "http://localhost:8000/filter?id=1"
```

В качестве источника в клиенте вам необходимо добавлять адрес вашего узла с вашим портом и номером подписки из sub.txt которую вы хотите фильтровать.

Например (адрес хоста и номер порта должны быть заменены на действительные). Проверьте также, что ваш клиент разрешен в uagent.txt.

http://localhost:8000/filter?id=1

### Сборка образа

 ```
docker build -t sub-filter .
 ```
#### Запуск с аргументами 

Порт 8000, TTL 1800, файлы в рабочей директории

 ```
docker run -d \
  --name sub-filter \
  -p 8000:8000 \
  -v $(pwd)/config:/config:ro \
  -v $(pwd)/cache:/cache:rw \
  sub-filter \
  8000 1800
 ```

 или

  ```
  podman run -d --replace \
  --name sub-filter \
  -p 8000:8000  \
  -v $(pwd)/config:/config:ro,z \
  -v $(pwd)/cache:/cache:rw,z \
  sub-filter \
  8000 1800
  ```