# sub-filter

simple subscription filter

Скрипт для фильтрации на лету подписок, для софта, который не поддерживает некоторые функции.

* проверяет валидность ссылок, убирает из них некоторые особенности, которые они не поддерживают
* позволяет фильтровать подписки по перечню плохих слов bad.txt
* удаляет возможные ханипоты из подписок, что важно если вы берете их из пабликов
* простое кеширование для снижения нагрузки на сетевые функции
* описание подписки приводится в человекочитаемый вид

### сборка

 ```
 go build -o filter main.go 
 ```

### запуск

 ```
 ./filter 8000 1800 sub.txt bad.txt uagent.txt
 ```

### параметры:

* порт, который слушать (8000)
* время кеширования подписки (1800)
* файл с подписками (sub.txt)
* запрещенные слова для подписок (bad.txt)
* юзерагенты, которые можно отдавать результат (uagent.txt)

### пример использования

получения отфильтрованной подписки из списка sub.txt с номером строки 1

http://localhost:8000/filter?id=1

### Сборка образа

 ```
docker build -t sub-filter .
 ```
#### Запуск с аргументами (порт 8000, TTL 1800, файлы в рабочей директории)

 ```
docker run -d \
  --name sub-filter \
  -p 8000:8000 \
  -v $(pwd)/sub.txt:/sub.txt:ro \
  -v $(pwd)/bad.txt:/bad.txt:ro \
  -v $(pwd)/uagent.txt:/uagent.txt:ro \
  sub-filter \
  8000 1800 ./sub.txt ./bad.txt ./uagent.txt
 ```

 или

  ```
  podman run -d --replace \
  --name sub-filter \
  -p 8000:8000  \
  -v ./sub.txt:/sub.txt:ro,z  -v ./bad.txt:/bad.txt:ro,z  -v ./uagent.txt:/uagent.txt:ro,z  \
  sub-filter \
  8000 1800 ./sub.txt ./bad.txt ./uagent.txt
  ```